/*! Backbone Gallery App - v1.0 - 2012-10-14
* Copyright (c) 2012 dhar; Licensed  */
(function(a){var b=a.app||{};b.config=b.config||{},b.config.fetchUrl="/gallery_data.json",a.app=b})(window),function(a){var b=a.app||{},c=Backbone.Model.extend({url:b.config.fetchUrl,initialize:function(){},getPhoto:function(a){return this.get("photos")[a]},getAlbumName:function(){return this.get("album").name},getAlbumLength:function(){return this.get("photos").length},findIndex:function(a){for(var b=0;b<this.get("photos").length;b++)if(a===this.get("photos")[b].id)return b;return-1}});b.models=b.models||{},b.models.Gallery=c,a.app=b}(window),function(a){var b=a.app||{},c=Backbone.View.extend({tagName:"header",id:"header",events:{"click #prev":"previous","click #next":"next"},initialize:function(a){this.controller=a.controller,this.model.on("change",this.render,this)},previous:function(){this.controller.trigger("nav/prev")},next:function(){this.controller.trigger("nav/next")},render:function(){return this.$el.find("h1").text(this.model.getAlbumName()),this}});b.views=b.views||{},b.views.Header=c,a.app=b}(window),function(a){var b=a.app||{},c=Backbone.View.extend({template:null,initialize:function(a){this.controller=a.controller},render:function(){this.template||(this.template=$("#imageTpl").html());var a=this.controller.currentIndex(),b=this.model.getPhoto(a);if(b){var c=Mustache.render(this.template,b);this.$el.html(c)}return this}});b.views=b.views||{},b.views.MainImage=c,a.app=b}(window),function(a){var b=a.app||{},c=Backbone.View.extend({template:null,events:{"click a":"thumbClicked"},initialize:function(a){this.controller=a.controller,this.model.on("change",this.render,this),this.controller.router.on("route:photo",this.currentChanged,this)},thumbClicked:function(a){return this.controller.trigger("nav/goto",$(a.currentTarget).attr("photoid")),!1},render:function(){this.template||(this.template=$("#thumbsTpl").html());var a=Mustache.render(this.template,this.model.toJSON());return this.$el.html(a),this},currentChanged:function(){var a=this.controller.currentIndex();this.$el.find("a").removeAttr("aria-selected").filter("[photoid="+this.model.getPhoto(a).id+"]").attr("aria-selected","true")}});b.views=b.views||{},b.views.Thumbnails=c,a.app=b}(window),function(a){var b=a.app||{},c=-1,d=Backbone.View.extend({initialize:function(a){this.controller=a.controller,this.headerView=new b.views.Header({model:this.model,controller:a.controller,el:"#header"}),this.imageView=new b.views.MainImage({model:this.model,controller:a.controller,el:"#main-image"}),this.thumbnailsView=new b.views.Thumbnails({model:this.model,controller:a.controller,el:"#thumbnails"})},nextPhoto:function(){this.updateIndex(c+1)},prevPhoto:function(){this.updateIndex(c-1)},gotoPhoto:function(a){var b=this.model.findIndex(a);b!==-1&&this.updateIndex(b)},updateIndex:function(a){var b=this.model.getAlbumLength();a<0&&(a=b+a);var d=a%b;c!==d&&(c=d,this.imageView.render(),this.controller.trigger("nav/changed",this.model.getPhoto(c)))},currentIndex:function(){return c}});b.views=b.views||{},b.views.Gallery=d,a.app=b}(window),function(a){var b=a.app||{},c=Backbone.Router.extend({routes:{"photo/:id":"photo"},initialize:function(a){this.controller=a.controller},photo:function(a){this.controller.trigger("nav/goto",a)}}),d=function(a){this.model=new b.models.Gallery,this.router=new c({controller:this}),this.view=new b.views.Gallery({model:this.model,controller:this}),this.on("nav/prev",function(){this.view.prevPhoto()},this),this.on("nav/next",function(){this.view.nextPhoto()},this),this.on("nav/goto",function(a){this.view.gotoPhoto(a)},this),this.on("nav/changed",function(a){this.router.navigate("/photo/"+a.id,{trigger:!0})}),this.model.on("change",function(){Backbone.history.start(),this.currentIndex()===-1&&this.view.updateIndex(0)},this),this.model.fetch(),this.currentIndex=this.view.currentIndex};_.extend(d.prototype,Backbone.Events);var e=new d}(window);